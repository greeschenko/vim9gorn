package vim9gorn

import (
	"strings"
)

const functionIndent = "  " // 2 spaces ‚Äî Vim9 style

// SectionGenerator ‚Äî Strategy –¥–ª—è —Å–µ–∫—Ü—ñ–π .vimrc
type SectionGenerator interface {
	Generate() string
}

type Gorn struct {
	sections  []SectionGenerator
}

// New —Å—Ç–≤–æ—Ä—é—î –Ω–æ–≤–∏–π Gorn
func New() *Gorn {
	return &Gorn{
		sections:  make([]SectionGenerator, 0),
	}
}

// AddSection –¥–æ–¥–∞—î —Å–µ–∫—Ü—ñ—é (Strategy)
func (g *Gorn) AddSection(s SectionGenerator) {
	g.sections = append(g.sections, s)
}

// Generate ‚Äî –≥–µ–Ω–µ—Ä—É—î –ø–æ–≤–Ω–∏–π vim9script
func (g *Gorn) Generate() string {
	var b strings.Builder
	b.WriteString("vim9script\n\n")
	b.WriteString("# Generated by vim9gorn üî•\n")
	b.WriteString("# Do not edit manually\n\n")

	// Sections
	for _, sec := range g.sections {
		b.WriteString(sec.Generate() + "\n")
	}

	return b.String()
}

// Forge ‚Äî –∑–∞–ø–∏—Å—É—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É —Ñ–∞–π–ª —á–µ—Ä–µ–∑ DI
func (g *Gorn) Forge(path string, writer FileWriter) error {
	content := g.Generate()
	return writer.Write(path, content)
}
